<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå KOZMIC MASTER STUDIO - Ultimate Edition üé∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            animation: cosmicPulse 6s ease-in-out infinite alternate;
        }

        @keyframes cosmicPulse {
            0% { background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460); }
            100% { background: linear-gradient(45deg, #16213e, #0f3460, #1a1a2e); }
        }

        .master-header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 107, 157, 0.1);
            border-bottom: 3px solid #ff6b9d;
            position: relative;
        }

        .master-title {
            font-size: clamp(2rem, 5vw, 4rem);
            background: linear-gradient(45deg, #ff6b9d, #4ecdc4, #ffd93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px rgba(255, 107, 157, 0.5); }
            100% { text-shadow: 0 0 40px rgba(78, 205, 196, 0.7); }
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: linear-gradient(45deg, #ff6b9d, #4ecdc4);
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #ffd93d, #ff6b9d);
            box-shadow: 0 0 30px rgba(255, 217, 61, 0.6);
            transform: scale(1.05);
        }

        .studio-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 70vh;
        }

        .mode-description {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid #4ecdc4;
        }

        .loading-indicator {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #4ecdc4;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #4ecdc4;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .cosmic-creature-master {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #ff6b9d, #4ecdc4, #ffd93d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            z-index: 1000;
            animation: creatureFloat 4s ease-in-out infinite;
            box-shadow: 0 0 25px rgba(255, 107, 157, 0.6);
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes creatureFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-20px) rotate(0deg); }
            75% { transform: translateY(-10px) rotate(-5deg); }
        }

        .creature-pulse {
            animation: creaturePulse 0.6s ease-out;
        }

        @keyframes creaturePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); box-shadow: 0 0 40px rgba(255, 217, 61, 0.8); }
            100% { transform: scale(1); }
        }

        .version-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 10px;
            font-size: 0.8rem;
            z-index: 100;
        }

        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 120px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff6b9d;
            border-radius: 10px;
            padding: 10px;
            font-size: 0.8rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .easter-egg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 107, 157, 0.95);
            border: 3px solid #ffd93d;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            font-size: 1.5rem;
            z-index: 2000;
            display: none;
            box-shadow: 0 0 50px rgba(255, 217, 61, 0.8);
        }

        /* Universal Button Styles */
        .kozmic-btn, .live-btn, .complete-btn {
            background: linear-gradient(45deg, #ff6b9d, #4ecdc4);
            border: none;
            padding: 12px 16px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kozmic-btn:hover, .live-btn:hover, .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
        }

        .kozmic-btn.active, .live-btn.active, .complete-btn.active {
            background: linear-gradient(45deg, #ffd93d, #ff6b9d);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
        }

        /* Effect Controls */
        .effect-knob {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, #333, #666);
            position: relative;
            cursor: pointer;
            margin: 5px auto;
            transition: transform 0.2s ease;
        }

        .effect-knob:hover {
            transform: scale(1.1);
        }

        .effect-knob::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 15px;
            background: #ff6b9d;
            border-radius: 2px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .master-title {
                font-size: 2rem;
            }
            
            .mode-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-btn {
                width: 90%;
                max-width: 300px;
            }
            
            .cosmic-creature-master {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
                bottom: 20px;
                right: 20px;
            }
            
            .status-bar {
                right: 90px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="version-indicator">
        <div>üåå KOZMIC MASTER STUDIO v4.0</div>
        <div id="currentMode">Mode: None</div>
    </div>

    <div class="master-header">
        <h1 class="master-title">üåå KOZMIC MASTER STUDIO üé∏</h1>
        <p style="font-size: 1.2rem; color: #4ecdc4;">Ultimate Edition - Three Professional Studios in One</p>
        
        <div class="mode-selector">
            <button class="mode-btn" data-mode="portable" onclick="switchMode('portable')">
                üé∏ PORTABLE STUDIO
            </button>
            <button class="mode-btn" data-mode="live" onclick="switchMode('live')">
                üé§ LIVE CONSOLE
            </button>
            <button class="mode-btn" data-mode="complete" onclick="switchMode('complete')">
                üè† COMPLETE STUDIO
            </button>
        </div>

        <div class="mode-description" id="modeDescription">
            <strong>Welcome to the Kozmic Master Studio!</strong><br>
            Choose a mode above to begin your cosmic musical journey.<br>
            Each mode offers unique features for different creative needs.
        </div>
    </div>

    <div class="studio-container" id="studioContainer">
        <div class="loading-indicator" style="display: none;" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <div>Loading Cosmic Frequencies...</div>
        </div>
    </div>

    <div class="status-bar">
        <span id="statusText">Ready to rock the cosmos! Select a studio mode.</span>
        <span id="statusTime">00:00</span>
    </div>

    <div class="cosmic-creature-master" id="cosmicCreatureMaster" onclick="pulseCreatureMaster()">üåå</div>

    <div class="easter-egg" id="easterEgg">
        <h2>üåü COSMIC HYPERNOVA ACTIVATED! üåü</h2>
        <p>You've unlocked the secret of universal harmony!</p>
        <button onclick="closeEasterEgg()" style="margin-top: 20px; padding: 10px 20px; background: #4ecdc4; border: none; border-radius: 10px; color: #000; font-weight: bold; cursor: pointer;">Continue Jamming</button>
    </div>

    <script>
        // Master Studio Core Variables
        let currentStudioMode = null;
        let sessionStartTime = Date.now();
        let creatureClicks = 0;
        let activeModules = {};
        let masterAudioContext = null;
        
        // Mode-specific variables
        let portableCanvas, portableCtx, portableGL;
        let portableAudioContext, portableSource, portableAnalyser, portableDataArray;
        let portableCurrentEffect = 'particles';
        let portableIntensity = 50;
        let portableIsAmplified = false;
        let portableParticles = [];
        let portableAnimationId;
        
        let liveCurrentGenre = 'none';
        let liveEffects = { slide: 0, drive: 0, reverb: 0, delay: 0, wah: 0, chorus: 0 };
        let liveAudioContext, liveSource, liveEffectsChain = {};
        
        let completeCurrentGenre = 'standard';
        let completeUADPlugins = {};
        let completeTracks = [];
        
        // Mode Descriptions
        const modeDescriptions = {
            portable: {
                title: "üé∏ Portable Studio Mode",
                description: "Mobile-friendly WebGL studio with cosmic visual effects, perfect for on-the-go jamming and quick recordings."
            },
            live: {
                title: "üé§ Live Console Mode", 
                description: "Professional live performance console with video integration, speech control, and real-time effects for stage use."
            },
            complete: {
                title: "üè† Complete Studio Mode",
                description: "Full-featured home studio with multitrack recording, world music genres, AI assistance, and professional mixing."
            }
        };

        // Shared Utility Functions
        function safeElement(id) {
            const el = document.getElementById(id);
            return el || { 
                textContent: '', 
                style: {}, 
                classList: { add: () => {}, remove: () => {}, toggle: () => {} },
                innerHTML: '',
                appendChild: () => {},
                removeChild: () => {}
            };
        }

        function updateStatus(message) {
            safeElement('statusText').textContent = message;
            console.log('Kozmic Master Studio:', message);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            safeElement('statusTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Mode Switching System
        async function switchMode(mode) {
            try {
                updateStatus(`Switching to ${mode} mode...`);
                showLoading(true);
                
                // Clear current mode
                if (currentStudioMode) {
                    clearCurrentMode();
                }
                
                // Update UI
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                
                // Update description
                const desc = modeDescriptions[mode];
                safeElement('modeDescription').innerHTML = `
                    <strong>${desc.title}</strong><br>
                    ${desc.description}
                `;
                
                safeElement('currentMode').textContent = `Mode: ${mode.toUpperCase()}`;
                
                // Load the selected mode
                await loadMode(mode);
                
                currentStudioMode = mode;
                showLoading(false);
                updateStatus(`${mode.toUpperCase()} mode active - Ready to rock!`);
                
                pulseCreatureMaster();
                
            } catch (error) {
                console.error('Mode switch error:', error);
                updateStatus('Error switching modes');
                showLoading(false);
            }
        }

        function showLoading(show) {
            safeElement('loadingIndicator').style.display = show ? 'block' : 'none';
        }

        function clearCurrentMode() {
            const container = safeElement('studioContainer');
            container.innerHTML = '';
            
            // Stop animations
            if (portableAnimationId) {
                cancelAnimationFrame(portableAnimationId);
                portableAnimationId = null;
            }
            
            // Close audio contexts
            if (portableAudioContext && portableAudioContext.state !== 'closed') {
                portableAudioContext.close();
                portableAudioContext = null;
            }
            if (liveAudioContext && liveAudioContext.state !== 'closed') {
                liveAudioContext.close();
                liveAudioContext = null;
            }
            
            // Clear variables
            portableParticles = [];
            activeModules = {};
        }

        // Mode Loading Functions
        async function loadMode(mode) {
            const container = safeElement('studioContainer');
            
            switch (mode) {
                case 'portable':
                    await loadPortableMode(container);
                    break;
                case 'live':
                    await loadLiveMode(container);
                    break;
                case 'complete':
                    await loadCompleteMode(container);
                    break;
                default:
                    throw new Error('Unknown mode: ' + mode);
            }
        }

        // PORTABLE STUDIO MODE
        async function loadPortableMode(container) {
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    <div style="position: relative; width: 100%; height: 50vh; min-height: 300px; background: linear-gradient(45deg, #2c2c4e, #1a1a2e); border: 3px solid #ff6b9d; border-radius: 20px; overflow: hidden;">
                        <canvas id="kozmicCanvas"></canvas>
                        <div style="position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.8); border: 2px solid #4ecdc4; border-radius: 12px; padding: 8px 12px; font-size: 0.8rem; color: #4ecdc4;">
                            <span id="portableStatus">READY</span>
                        </div>
                        <div style="position: absolute; bottom: 15px; left: 15px; right: 15px; height: 8px; background: rgba(0,0,0,0.5); border-radius: 4px; overflow: hidden; border: 1px solid #4ecdc4;">
                            <div id="portablePowerBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, #4ecdc4, #ff6b9d, #ffd93d); transition: width 0.1s ease; border-radius: 3px;"></div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                        <div style="background: rgba(44, 44, 78, 0.9); border: 2px solid #ff6b9d; border-radius: 15px; padding: 20px;">
                            <h3 style="color: #ff6b9d; text-align: center; margin-bottom: 15px;">üéµ AUDIO INPUT</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                <button class="kozmic-btn" onclick="connectPortableAudio()">CONNECT</button>
                                <button class="kozmic-btn" onclick="togglePortableRecord()">RECORD</button>
                                <button class="kozmic-btn" onclick="togglePortableAmplify()">AMPLIFY</button>
                                <button class="kozmic-btn" onclick="exportPortableRecording()">EXPORT</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 3px; height: 60px; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 5px;">
                                ${Array(8).fill().map(() => 
                                    '<div class="freq-bar" style="background: linear-gradient(to top, #4ecdc4, #ff6b9d, #ffd93d); border-radius: 3px; transition: height 0.1s ease; min-height: 2px;"></div>'
                                ).join('')}
                            </div>
                        </div>
                        
                        <div style="background: rgba(44, 44, 78, 0.9); border: 2px solid #ff6b9d; border-radius: 15px; padding: 20px;">
                            <h3 style="color: #ff6b9d; text-align: center; margin-bottom: 15px;">üåÄ COSMIC EFFECTS</h3>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px 0;">
                                <button class="effect-btn active" data-effect="particles" onclick="setPortableEffect('particles')">PARTICLES</button>
                                <button class="effect-btn" data-effect="nebula" onclick="setPortableEffect('nebula')">NEBULA</button>
                                <button class="effect-btn" data-effect="waveform" onclick="setPortableEffect('waveform')">WAVEFORM</button>
                                <button class="effect-btn" data-effect="cosmic" onclick="setPortableEffect('cosmic')">COSMIC</button>
                                <button class="effect-btn" data-effect="spiral" onclick="setPortableEffect('spiral')">SPIRAL</button>
                                <button class="effect-btn" data-effect="burst" onclick="setPortableEffect('burst')">BURST</button>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="kozmic-btn" onclick="adjustPortableIntensity()">INTENSITY: ${portableIntensity}%</button>
                                <button class="kozmic-btn" onclick="savePortableSession()">SAVE SESSION</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                    .effect-btn {
                        padding: 8px 4px;
                        font-size: 0.8rem;
                        background: rgba(0, 0, 0, 0.3);
                        border: 1px solid #4ecdc4;
                        color: #4ecdc4;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    }
                    .effect-btn:hover { background: rgba(78, 205, 196, 0.2); border-color: #ff6b9d; color: #ff6b9d; }
                    .effect-btn.active { background: #4ecdc4; color: #000; }
                </style>
            `;
            
            // Initialize WebGL for portable mode
            initPortableWebGL();
            updateStatus('Portable Studio loaded - Perfect for mobile jamming!');
        }

        // LIVE CONSOLE MODE
        async function loadLiveMode(container) {
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: rgba(255, 107, 157, 0.15); border: 2px solid #ff6b9d; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #ff6b9d; margin-bottom: 15px; text-align: center;">üé∏ Guitar Input</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="live-btn" onclick="connectLiveGuitar()">Connect Guitar</button>
                            <button class="live-btn" onclick="toggleLiveAudioRecord()">Record Audio</button>
                            <button class="live-btn" onclick="toggleLiveVideoRecord()">Record Video</button>
                            <button class="live-btn" onclick="exportLiveTrack()">Export Track</button>
                        </div>
                        <div style="margin-top: 15px; height: 100px; background: rgba(0,0,0,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #4ecdc4;">
                            üé∏ Guitar Visualization Ready
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 107, 157, 0.15); border: 2px solid #ff6b9d; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #ff6b9d; margin-bottom: 15px; text-align: center;">üéõÔ∏è Effects Rack</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                            ${['slide', 'drive', 'reverb', 'delay', 'wah', 'chorus'].map(effect => `
                                <div style="text-align: center;">
                                    <label style="font-size: 0.8rem; color: #4ecdc4;">${effect.charAt(0).toUpperCase() + effect.slice(1)}</label>
                                    <div class="effect-knob" onclick="adjustLiveEffect('${effect}')"></div>
                                    <div style="font-size: 0.7rem; color: #ffd93d;" id="${effect}Value">0%</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="live-btn" onclick="killLiveEffects()">Kill Effects</button>
                            <button class="live-btn" onclick="randomLiveEffects()">Random Mode</button>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 107, 157, 0.15); border: 2px solid #ff6b9d; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #ff6b9d; margin-bottom: 15px; text-align: center;">üéµ Genre Presets</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            ${['motown', 'blues', 'jazz', 'rock', 'funk', 'psychedelic'].map(genre => `
                                <button class="live-btn" onclick="setLiveGenre('${genre}')">${genre.charAt(0).toUpperCase() + genre.slice(1)}</button>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px;">
                            <label style="color: #4ecdc4;">BPM:</label>
                            <input type="number" id="liveBPM" value="120" min="60" max="200" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid #4ecdc4; border-radius: 5px;">
                        </div>
                    </div>
                </div>
            `;
            
            updateStatus('Live Console loaded - Perfect for performance!');
        }

        // COMPLETE STUDIO MODE
        async function loadCompleteMode(container) {
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: rgba(0, 0, 0, 0.7); border: 2px solid #00ffff; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #00ffff; text-align: center; margin-bottom: 15px;">üåç World Music</h3>
                        <select id="completeGenreSelect" onchange="changeCompleteGenre(this.value)" style="width: 100%; padding: 10px; background: #1a1a1a; border: 2px solid #00ffff; color: #fff; border-radius: 8px; margin-bottom: 15px;">
                            <option value="standard">Standard</option>
                            <option value="motown">Motown (Funk Brothers)</option>
                            <option value="wreckingCrew">Wrecking Crew</option>
                            <option value="reggae">Reggae</option>
                            <option value="psychedelic">Psychedelic</option>
                            <option value="indian">Indian Classical</option>
                            <option value="african">African Polyrhythms</option>
                        </select>
                        <div id="completeInstrumentGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            ${['Kick', 'Snare', 'Hi-Hat', 'Crash', 'Bass', 'Guitar', 'Keys', 'Vocals'].map((instrument, index) => `
                                <button class="instrument-pad" onclick="playCompleteInstrument(${index}, '${instrument}')">${instrument}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.7); border: 2px solid #ff6600; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #ff6600; text-align: center; margin-bottom: 15px;">üîä UAD Plugins</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                            ${['LA-2A', '1176', 'Lexicon', 'Galaxy', 'Pultec', 'Ruby'].map(plugin => `
                                <div style="background: linear-gradient(45deg, #333, #666); border: 2px solid #ff6600; border-radius: 10px; padding: 10px; text-align: center; cursor: pointer;" onclick="toggleCompleteUAD('${plugin}')">
                                    <div style="font-weight: bold; font-size: 0.8em;">${plugin}</div>
                                    <div style="font-size: 0.7em; color: #00ff00;" id="${plugin}Status">0%</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="complete-btn" onclick="loadCompleteUAD()">Load Presets</button>
                            <button class="complete-btn" onclick="resetCompleteUAD()">Reset All</button>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.7); border: 2px solid #4ade80; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #4ade80; text-align: center; margin-bottom: 15px;">üéôÔ∏è Multitrack</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                            <button class="complete-btn" onclick="startCompleteRecording()">Record</button>
                            <button class="complete-btn" onclick="stopCompleteRecording()">Stop</button>
                            <button class="complete-btn" onclick="exportCompleteSession()">Export</button>
                        </div>
                        <canvas id="completeWaveform" width="100%" height="80" style="width: 100%; height: 80px; background: #1a1a1a; border: 2px solid #4ade80; border-radius: 10px;"></canvas>
                        <div id="completeTrackList" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 0.8em; max-height: 60px; overflow-y: auto;">
                            No tracks recorded yet...
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.7); border: 2px solid #9333ea; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #9333ea; text-align: center; margin-bottom: 15px;">ü§ñ AI Assistant</h3>
                        <div id="completeAISuggestions" style="background: rgba(0,255,255,0.1); border: 2px solid #00ffff; border-radius: 10px; padding: 15px; margin: 15px 0; min-height: 80px;">
                            <div style="color: #00ffff; font-weight: bold;">ü§ñ AI Ready</div>
                            <div style="color: #fff; margin-top: 5px;">Click "Get Suggestion" for musical inspiration!</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="complete-btn" onclick="getCompleteAISuggestion()">Get Suggestion</button>
                            <button class="complete-btn" onclick="analyzeCompleteJam()">Analyze Jam</button>
                        </div>
                    </div>
                </div>
                
                <style>
                    .instrument-pad {
                        background: linear-gradient(45deg, #2a2a2a, #4a4a4a);
                        border: 2px solid #666;
                        color: #fff;
                        padding: 10px 5px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-family: inherit;
                        font-size: 0.7rem;
                        transition: all 0.2s ease;
                        text-align: center;
                    }
                    .instrument-pad:hover {
                        background: linear-gradient(45deg, #4a4a4a, #6a6a6a);
                        border-color: #00ffff;
                        box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
                    }
                </style>
            `;
            
            updateStatus('Complete Studio loaded - Full professional features!');
        }

        // PORTABLE STUDIO FUNCTIONS
        function initPortableWebGL() {
            try {
                const canvas = document.getElementById('kozmicCanvas');
                if (!canvas) return;
                
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                // Try WebGL first, fallback to 2D
                try {
                    portableGL = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    if (!portableGL) throw new Error('WebGL not supported');
                    
                    portableGL.viewport(0, 0, canvas.width, canvas.height);
                    portableGL.clearColor(0.1, 0.1, 0.18, 1.0);
                    
                    updateStatus('WebGL initialized successfully! ‚ú®');
                } catch (error) {
                    portableCtx = canvas.getContext('2d');
                    updateStatus('Using 2D Canvas (WebGL unavailable)');
                }
                
                createPortableParticles();
                startPortableVisualization();
                
            } catch (error) {
                console.error('Canvas init error:', error);
                updateStatus('Canvas initialization failed');
            }
        }

        function createPortableParticles() {
            portableParticles = [];
            const count = Math.min(100, portableIntensity * 2);
            
            for (let i = 0; i < count; i++) {
                portableParticles.push({
                    x: Math.random() * (portableCanvas?.width || 800),
                    y: Math.random() * (portableCanvas?.height || 400),
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    size: Math.random() * 3 + 1,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    life: 1.0,
                    decay: Math.random() * 0.02 + 0.005
                });
            }
        }

        function startPortableVisualization() {
            function animate() {
                if (currentStudioMode === 'portable') {
                    portableAnimationId = requestAnimationFrame(animate);
                    renderPortableEffect();
                }
            }
            animate();
        }

        function renderPortableEffect() {
            if (portableGL) {
                portableGL.clear(portableGL.COLOR_BUFFER_BIT);
                // WebGL rendering would go here
            } else if (portableCtx) {
                portableCtx.fillStyle = 'rgba(26, 26, 46, 0.1)';
                portableCtx.fillRect(0, 0, portableCtx.canvas.width, portableCtx.canvas.height);
                
                // Simple particle rendering
                portableParticles.forEach((particle, index) => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    
                    if (particle.x < 0 || particle.x > portableCtx.canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > portableCtx.canvas.height) particle.vy *= -1;
                    
                    if (particle.life <= 0) {
                        portableParticles[index] = {
                            x: Math.random() * portableCtx.canvas.width,
                            y: Math.random() * portableCtx.canvas.height,
                            vx: (Math.random() - 0.5) * 4,
                            vy: (Math.random() - 0.5) * 4,
                            size: Math.random() * 3 + 1,
                            color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                            life: 1.0,
                            decay: Math.random() * 0.02 + 0.005
                        };
                    }
                    
                    portableCtx.save();
                    portableCtx.globalAlpha = particle.life;
                    portableCtx.fillStyle = particle.color;
                    portableCtx.beginPath();
                    portableCtx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    portableCtx.fill();
                    portableCtx.restore();
                });
            }
        }

        async function connectPortableAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                portableAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                portableSource = portableAudioContext.createMediaStreamSource(stream);
                portableAnalyser = portableAudioContext.createAnalyser();
                portableAnalyser.fftSize = 2048;
                portableDataArray = new Uint8Array(portableAnalyser.frequencyBinCount);
                
                portableSource.connect(portableAnalyser);
                
                safeElement('portableStatus').textContent = 'LIVE';
                updateStatus('Portable audio connected! üé∏');
            } catch (error) {
                updateStatus('Audio connection failed');
            }
        }

        function setPortableEffect(effect) {
            portableCurrentEffect = effect;
            document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-effect="${effect}"]`)?.classList.add('active');
            updateStatus(`Effect: ${effect.toUpperCase()}`);
        }

        function adjustPortableIntensity() {
            portableIntensity = portableIntensity >= 100 ? 25 : portableIntensity + 25;
            createPortableParticles();
            updateStatus(`Intensity: ${portableIntensity}%`);
            
            // Update button text
            const btn = event.target;
            if (btn) btn.textContent = `INTENSITY: ${portableIntensity}%`;
        }

        function togglePortableAmplify() {
            portableIsAmplified = !portableIsAmplified;
            updateStatus(`Amplify: ${portableIsAmplified ? 'ON' : 'OFF'}`);
        }

        function togglePortableRecord() {
            updateStatus('Recording toggled');
        }

        function exportPortableRecording() {
            updateStatus('Export feature - record something first!');
        }

        function savePortableSession() {
            const sessionData = {
                mode: 'portable',
                effect: portableCurrentEffect,
                intensity: portableIntensity,
                amplified: portableIsAmplified,
                timestamp: Date.now()
            };
            
            const blob = new Blob([JSON.stringify(sessionData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kozmic-portable-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            updateStatus('Portable session saved! üíæ');
        }

        // LIVE CONSOLE FUNCTIONS
        async function connectLiveGuitar() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                liveAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                liveSource = liveAudioContext.createMediaStreamSource(stream);
                updateStatus('Live guitar connected! üé∏');
            } catch (error) {
                updateStatus('Guitar connection failed');
            }
        }

        function adjustLiveEffect(effect) {
            liveEffects[effect] = (liveEffects[effect] + 25) % 101;
            const valueElement = document.getElementById(effect + 'Value');
            if (valueElement) valueElement.textContent = liveEffects[effect] + '%';
            updateStatus(`${effect}: ${liveEffects[effect]}%`);
        }

        function killLiveEffects() {
            Object.keys(liveEffects).forEach(effect => {
                liveEffects[effect] = 0;
                const valueElement = document.getElementById(effect + 'Value');
                if (valueElement) valueElement.textContent = '0%';
            });
            updateStatus('All effects killed! üîá');
        }

        function randomLiveEffects() {
            Object.keys(liveEffects).forEach(effect => {
                liveEffects[effect] = Math.floor(Math.random() * 101);
                const valueElement = document.getElementById(effect + 'Value');
                if (valueElement) valueElement.textContent = liveEffects[effect] + '%';
            });
            updateStatus('Effects randomized! üé≤');
        }

        function setLiveGenre(genre) {
            liveCurrentGenre = genre;
            updateStatus(`Genre: ${genre.toUpperCase()}`);
        }

        function toggleLiveAudioRecord() {
            updateStatus('Audio recording toggled');
        }

        function toggleLiveVideoRecord() {
            updateStatus('Video recording toggled');
        }

        function exportLiveTrack() {
            updateStatus('Track export - record something first!');
        }

        // COMPLETE STUDIO FUNCTIONS
        function changeCompleteGenre(genre) {
            completeCurrentGenre = genre;
            updateStatus(`Complete genre: ${genre.toUpperCase()}`);
            
            const instruments = {
                standard: ['Kick', 'Snare', 'Hi-Hat', 'Crash', 'Bass', 'Guitar', 'Keys', 'Vocals'],
                motown: ['Jamerson Bass', 'Benny Drums', 'Messina Guitar', 'Van Dyke Keys', 'Horns', 'Strings', 'Tamb', 'Vocals'],
                indian: ['Sitar', 'Tabla', 'Tanpura', 'Bansuri', 'Harmonium', 'Veena', 'Mridangam', 'Drone'],
                african: ['Djembe', 'Kora', 'Balafon', 'Shekere', 'Talking Drum', 'Mbira', 'Bass', 'Vocals']
            };
            
            const genreInstruments = instruments[genre] || instruments.standard;
            const grid = document.getElementById('completeInstrumentGrid');
            if (grid) {
                grid.innerHTML = genreInstruments.map((instrument, index) => `
                    <button class="instrument-pad" onclick="playCompleteInstrument(${index}, '${instrument}')">${instrument}</button>
                `).join('');
            }
        }

        function playCompleteInstrument(index, instrument) {
            updateStatus(`Playing: ${instrument}`);
        }

        function toggleCompleteUAD(plugin) {
            completeUADPlugins[plugin] = (completeUADPlugins[plugin] || 0) + 25;
            if (completeUADPlugins[plugin] > 100) completeUADPlugins[plugin] = 0;
            
            const statusElement = document.getElementById(plugin + 'Status');
            if (statusElement) statusElement.textContent = completeUADPlugins[plugin] + '%';
            updateStatus(`${plugin}: ${completeUADPlugins[plugin]}%`);
        }

        function loadCompleteUAD() {
            updateStatus('UAD presets loaded');
        }

        function resetCompleteUAD() {
            Object.keys(completeUADPlugins).forEach(plugin => {
                completeUADPlugins[plugin] = 0;
                const statusElement = document.getElementById(plugin + 'Status');
                if (statusElement) statusElement.textContent = '0%';
            });
            updateStatus('UAD plugins reset');
        }

        function startCompleteRecording() {
            updateStatus('Multitrack recording started');
        }

        function stopCompleteRecording() {
            updateStatus('Recording stopped');
        }

        function exportCompleteSession() {
            updateStatus('Session exported');
        }

        function getCompleteAISuggestion() {
            const suggestions = [
                "Try adding a seventh chord progression in the current key",
                "Consider layering a bass line with quarter note patterns",
                "Add some reverb to create spatial depth",
                "Experiment with polyrhythms for complexity",
                "Use the Pultec EQ to brighten the high frequencies"
            ];
            
            const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
            document.getElementById('completeAISuggestions').innerHTML = `
                <div style="color: #00ffff; font-weight: bold;">ü§ñ AI Suggestion</div>
                <div style="color: #fff; margin-top: 5px;">${suggestion}</div>
            `;
            updateStatus('AI suggestion provided');
        }

        function analyzeCompleteJam() {
            document.getElementById('completeAISuggestions').innerHTML = `
                <div style="color: #00ffff; font-weight: bold;">üìä Jam Analysis</div>
                <div style="color: #fff; margin-top: 5px;">
                    Genre: ${completeCurrentGenre}<br>
                    Active Plugins: ${Object.keys(completeUADPlugins).length}<br>
                    Tracks: ${completeTracks.length}<br>
                    Status: ${completeTracks.length < 3 ? 'Add more layers' : 'Ready for mixing'}
                </div>
            `;
            updateStatus('Jam analysis complete');
        }

        // MASTER STUDIO FUNCTIONS
        function pulseCreatureMaster() {
            creatureClicks++;
            const creature = safeElement('cosmicCreatureMaster');
            creature.classList.add('creature-pulse');
            
            setTimeout(() => {
                creature.classList.remove('creature-pulse');
            }, 600);

            if (creatureClicks >= 5) {
                triggerMasterHypernova();
                creatureClicks = 0;
            }

            updateStatus(`Cosmic creature pulsed! (${creatureClicks}/5)`);
        }

        function triggerMasterHypernova() {
            safeElement('easterEgg').style.display = 'block';
            document.body.style.filter = 'brightness(3)';
            setTimeout(() => {
                document.body.style.filter = 'brightness(1)';
            }, 200);
            
            updateStatus('üåü HYPERNOVA ACTIVATED! üåü');
        }

        function closeEasterEgg() {
            safeElement('easterEgg').style.display = 'none';
            updateStatus('Hypernova complete - continue jamming!');
        }

        // INITIALIZATION
        window.addEventListener('load', () => {
            sessionStartTime = Date.now();
            setInterval(updateTimer, 1000);
            updateStatus('üåå KOZMIC MASTER STUDIO ready! Select a mode to begin.');
            
            // Auto-load portable mode for demo
            setTimeout(() => {
                switchMode('portable');
            }, 1000);
        });

        // KEYBOARD CONTROLS
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        switchMode('portable');
                        break;
                    case '2':
                        e.preventDefault();
                        switchMode('live');
                        break;
                    case '3':
                        e.preventDefault();
                        switchMode('complete');
                        break;
                }
            }
        });

        // RESPONSIVE HANDLING
        window.addEventListener('resize', () => {
            if (portableCanvas && currentStudioMode === 'portable') {
                const container = portableCanvas.parentElement;
                if (container) {
                    portableCanvas.width = container.clientWidth;
                    portableCanvas.height = container.clientHeight;
                    
                    if (portableGL) {
                        portableGL.viewport(0, 0, portableCanvas.width, portableCanvas.height);
                    }
                }
            }
        });

        console.log('üåå KOZMIC MASTER STUDIO v4.0 loaded successfully! üé∏');
    </script>
</body>
</html>
